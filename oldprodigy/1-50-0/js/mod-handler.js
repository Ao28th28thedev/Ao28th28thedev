var GameMods={available:[{id:"WalkSpeed",patch:"initWalkSpeedMod"},{id:"FastGameSpeed",patch:"initFastGameSpeedMod"},{id:"RebalancedBattles",patch:"initRebalancedBattleMod"}]};class ModHandler{constructor(e){this.game=e,this.animations=new class{constructor(){this.animations=[]}getAll(){let e=[];for(let t=0;t<this.animations.length;t++)e.push(this.animations[t].animation);return e}register(e,t){this.animations.push({animation:e,baseSpeed:t})}clear(){this.animations=[]}},this.tweens=new class{constructor(){this.tweens=[]}getAll(){return this.tweens}getTweens(){let e=[];for(let t=0;t<this.tweens.length;t++)e.push(this.tweens[t].tween);return e}register(e,t,i,a){this.tweens.push({tween:t,_parent:e,baseDelay:i,baseDuration:a})}clear(){this.tweens=[]}}}log(e){Util.isDefined(e)&&console.log("%c %c %c "+e+" %c %c ","background: #1724","background: #172a","background: #172f; color: #FFF","background: #172a","background: #1724")}info(e){Util.isDefined(e)&&console.log("%c %c %c "+e+" %c %c ","background: #14b4","background: #14ba","background: #14bf; color: #FFF","background: #14ba","background: #14b4")}error(e){Util.isDefined(e)&&console.log("%c %c %c "+e+" %c %c ","background: #a114","background: #a11a","background: #a11f; color: #FFF","background: #a11a","background: #a114")}initWalkSpeedMod(){this.game.prodigy.player.walkSpeed=1,Prodigy.Container.CreatureContainer.prototype.setPath=function(e,t,i){if(Util.isDefined(e)){this.game.tweens.removeFrom(this,!1),this.game.tweens.removeFrom(this.sprites),Util.isDefined(i)||(i=this.game.prodigy.player.walkSpeed*this.walkSpeed);for(var a=null,s=null,n=this.x,r=this.y,o=e.length-1;o>=0;o--){var d=e[o];Util.isDefined(d.x)||(d.x=n),Util.isDefined(d.y)||(d.y=r);var l=Phaser.Math.distance(d.x,d.y,n,r);0!==l&&(Util.isDefined(a)||(a=this.game.add.tween(this),s=this.game.add.tween(this.sprites.scale)),a.to({x:d.x,y:d.y},6*l/i,Phaser.Easing.Linear.None),s.to({x:d.x>n?1:-1},1,Phaser.Easing.Linear.None),s.to({},6*l/i-100,Phaser.Easing.Linear.None),n=d.x,r=d.y)}Util.isDefined(a)?(a.onComplete.addOnce(this.stand,this),Util.isDefined(t)&&a.onComplete.addOnce(t),this.walk(),this.mode=0,Util.isDefined(a)&&a.start(),Util.isDefined(s)&&s.start()):(Util.isDefined(t)&&t(),this.stand())}},Prodigy.Menu.SystemMenu.prototype.openOther=function(){this.game.prodigy.create.textButton(this.content,150,50,{text:"Get Epics!",size:Prodigy.Control.TextButton.MED},this.unlockEpics.bind(this)),this.game.prodigy.create.textButton(this.content,150,125,{text:"Toggle Member",size:Prodigy.Control.TextButton.MED},this.toggleMember.bind(this)),this.walkSpeedBar=this.game.prodigy.create.slider(this.content,37,215,525,!1,!1),this.walkSpeedBar.reset(200,0,Math.floor((this.game.prodigy.player.walkSpeed-.1)*10),this.setWalkSpeed.bind(this))},Prodigy.Menu.SystemMenu.prototype.setWalkSpeed=function(){this.game.prodigy.player.walkSpeed=(this.walkSpeedBar.page+1)/10,this.game.prodigy.create.font(this.content,37,185,"Walk Speed",{width:525,align:"center"})}}initFastGameSpeedMod(){var e=Phaser.TweenManager.prototype.add,t=this.game,i=Phaser.Timer.prototype.add,a=Phaser.Tween.prototype.delay,s=Phaser.Tween.prototype.to,n=(Boot.prototype.update,Phaser.AnimationManager.prototype.play),r=Prodigy.TweenController.prototype.set,o=Phaser.AnimationManager.prototype.add,d=Phaser.Game.prototype.update,l=this.animations,c=this.tweens;Phaser.Game.prototype.update=function(e){for(let t=0;t<l.animations.length;t++)Util.isDefined(l.animations[t].animation._parent)||l.animations.splice(t,1);for(let i=0,a=c.getAll();i<a.length;i++)a[i]._parent.src.alive||a.splice(i,1);return d.call(this,e)},window.setGameSpeed=function(d){var h=d;if(h<.1){ModHooks.error("Supplied speed multiplier is too low. Try a larger speed value.");return}if(Phaser.TweenManager.prototype.add=function(t){t.timeScale=h,e.call(this,t)},Phaser.Timer.prototype.add=function(e,t,a){return e/=h,i.call(this,e,t,a)},Phaser.Tween.prototype.delay=function(e,t){return e/=h,a.call(this,e,t)},Phaser.Tween.prototype.to=function(e,t,i,a,n,r,o){return Util.isDefined(n)&&(n/=h),s.call(this,e,t,i,a,n,r,o)},Phaser.AnimationManager.prototype.add=function(e,t,i,a,s){let n=10;Util.isDefined(i)&&(n=i,i*=h);let r=o.call(this,e,t,i,a,s);return l.register(r,n),r},Phaser.AnimationManager.prototype.play=function(e,t,i,a){return Util.isDefined(t)&&!isNaN(t)&&(t*=h),n.call(this,e,t,i,a)},Prodigy.TweenController.prototype.set=function(e,t,i,a){let s=i,n=a;Util.isDefined(i)&&(i/=h),Util.isDefined(a)&&(a/=h);let o=r.call(this,e,t,i,a);return c.register(this,this.tweens[this.tweens.length-1],s,n),o},Util.isDefined(t.tweens))for(var p=t.tweens.getAll(),g=0;g<p.length;g++)p[g].timeScale=h;if(Util.isDefined(l))for(var m=l.getAll(),u=0;u<m.length;u++)m[u].speed=h*(Util.isDefined(l.animations[u].baseSpeed)?l.animations[u].baseSpeed:10);if(Util.isDefined(c))for(var f=c.getAll(),y=0,_=c.getTweens();y<f.length;y++)_[y].delay=f[y].baseDelay/h,_[y].duration=_[y].frames.length*f[y].baseDelay*f[y].baseDuration/h},window.setGameSpeed(3),setTimeout(()=>{this.info('Use "setGameSpeed(speed)" to change the game speed at anytime.')},1e3)}initRebalancedBattleMod(){Prodigy.Creature.ATTACK_BONUS={"A+":1.6,A:1.45,"A-":1.3,"B+":1.15,B:1,"B-":.925,"C+":.85,C:.775,"C-":.7},Prodigy.Attacks.prototype.calculateDamage=function(e,t,i,a,s){Util.isDefined(a)||(a=0);var n=0;Util.isDefined(e)&&Util.isDefined(e.damage)&&(n=e.damage);var r=e.element,o=i.getElement(),d=0,l="B",c=0;return Util.isDefined(t)?(d=1+(t.getLevel()-1),l=Util.isDefined(t.source)&&Util.isDefined(t.source.power)?t.source.power:l,c=(d+10)/11):c=1,"Glacial Shield"!==e.name&&0===i.modifiers.ignoreElement&&(this.isStrong(r,o)?n+=4:this.isWeak(r,o)&&0>=(n-=3)&&(n=2)),Math.max(Math.floor((n=Math.floor(10*n*s*c*Prodigy.Creature.ATTACK_BONUS[l]))+(Util.isDefined(a)?a:0)),0)},Prodigy.Creature.getHeartsFromCurve=function(e,t,i){var a=Prodigy.Creature.HP_BONUS[e];return 20*(Math.floor((20+a)*(i-1)/20)-Math.floor((20+a)*(t-1)/20))},Attack.prototype.damage=function(){this.calculateDamageDone(),Util.isDefined(this.atk.type)&&"epic-attack"===this.atk.type&&(Util.isDefined(this.epic)?this.game.prodigy.effects.characterImage(this.game.prodigy.create.sprite(this.epic.x,this.epic.y-50,"battle","text-epic-attack")):this.game.prodigy.effects.characterImage(this.game.prodigy.create.sprite(this.source.x,this.source.y-50,"battle","text-epic-attack"))),this.potionActive=!1,this.shieldTime=0;var e=0;if(Util.isDefined(this.target.source.modifiers)&&Util.isDefined(this.target.source.modifiers.potion)){var t=Items.getItemData("item",this.target.source.modifiers.potion);if(Util.isDefined(t.subType)&&"elemental"===t.subType&&Util.isDefined(this.atk.element)&&("all"===t.element||this.atk.element===t.element)){this.potionActive=!0,this.shieldTime=1e3,e=t.potency*this.damageDone/10,this.damageDone-=Math.round(e);var i=this.target.sprites.add(this.game.prodigy.create.sprite(0,-75,"icons","potion-buff-"+t.element));i.anchor.setTo(.5,.5);var a=this.game.add.tween(i).to({alpha:0},1300,Phaser.Easing.Quadratic.Out),s=this.game.add.tween(i.scale).to({x:4,y:4},1300,Phaser.Easing.Quadratic.Out);a.start(),s.onComplete.add(function(){i.destroy()},i),s.start()}}var n="",r=Math.random()<this.CRITICAL_HIT_THRESHOLD+this.criticalThresholdBonus&&"PVP"!==this.game.state.current||"epic-attack"===this.atk.type;r?(this.damageDone=Math.round(1.5*this.damageDone),this.game.prodigy.effects.characterImage(this.game.prodigy.create.sprite(this.target.x,this.source.y+50,"battle","text-critical-hit"),1e3+this.shieldTime),n="critical-hit"):n="normal-hit",this.processStars(),this.lastTargetHp=this.target.source.getCurrentHearts(),this.target.source.changeCurrentHearts(-this.damageDone),this.game.prodigy.effects.characterText("-"+this.damageDone,this.target.x,this.source.y,this.shieldTime,{size:1,font:"battle",mono:44}),this.game.prodigy.audio.playSFX(Prodigy.Controller.AudioController.SFX_PACKS.BATTLE,n);var o=null;r||0!==this.target.source.modifiers.ignoreElement||(this.game.prodigy.attacks.isStrong(this.atk.element,this.target.source.getElement())?o="Powerful!":this.game.prodigy.attacks.isWeak(this.atk.element,this.target.source.getElement())&&(o="Weak...")),Util.isDefined(o)&&(this.delayComplete=!0,this.game.prodigy.effects.characterText(o,this.target.x,this.source.y+50,1e3+this.shieldTime))}}}function checkForMods(e,t){window.ModHooks=new ModHandler(e),ModHooks.log("Checking for mods...");for(var i=0,a=0;a<GameMods.available.length;a+=1)if(t.includes(GameMods.available[a].id))try{var s=GameMods.available[a].patch;ModHooks[s].call(ModHooks),ModHooks.log('Mod "'+GameMods.available[a].id+'" successfully applied!'),i+=1}catch(n){ModHooks.error('Error occured while applying mod "'+GameMods.available[a].id+'" to Prodigy!'),console.error(n)}i>0?ModHooks.log("Applied ("+i+") mods to the game"):ModHooks.log("No mods have been applied")}